class e{constructor(e){this.elem="string"==typeof e?document.createElement(e):e}attr(e,t){return this.elem.setAttribute(e,t),this}appendTo(e){return e.elem.appendChild(this.elem),this}append(e){return Array.isArray(e)?e.forEach((e=>this.elem.appendChild(e.elem))):this.elem.appendChild(e.elem),this}on(e,t){return this.elem.addEventListener(e,t),this}text(e){return this.elem.textContent=e,this}addClass(...e){return e.forEach((e=>this.elem.classList.add(e))),this}removeClass(e){return this.elem.classList.remove(e),this}hasClass(e){return this.elem.classList.contains(e)}empty(){return this.elem.innerHTML="",this}remove(){var e;null===(e=this.elem.parentElement)||void 0===e||e.removeChild(this.elem)}}const t=t=>new e(t);class n{constructor(e,t,n){this.data=e,this.plugins=n,this.pluginContext={},this.path=Array.isArray(t)?t:[t],this.nodeName=this.path[this.path.length-1],this.init()}render(e){if("string"==typeof e&&!(e=document.getElementById(e)))throw new Error(`Container element with id '${e}' not found`);this.wrapper=t("div").addClass("prop-wrapper"),e.appendChild(this.wrapper.elem);for(const e in this.pluginContext)this.pluginContext[e].node.reRender=()=>{this.wrapper.empty(),this.init(),this.renderInternal()};this.renderInternal()}toggleExpand(e){if(!this.isExpandable)return;const t=this.wrapper.hasClass(a);if((e=void 0===e?!t:e)!=t){if(e){this.wrapper.addClass(a);let e=Object.keys(this.data);this.plugins.forEach(((t,n)=>{t.beforeRenderProperties&&(e=t.beforeRenderProperties(this.pluginContext[n],e))})),this.renderProperties(this.childrenWrapper,e),this.plugins.forEach(((t,n)=>{var r;return null===(r=t.afterRenderProperties)||void 0===r?void 0:r.call(t,this.pluginContext[n],e)}))}else this.wrapper.removeClass(a),this.childrenWrapper.empty();this.plugins.forEach(((t,n)=>{var r;return null===(r=t.afterToggleExpand)||void 0===r?void 0:r.call(t,this.pluginContext[n],!!e)}))}}renderProperties(e,t){t.forEach((t=>new n(this.data[t],[...this.path,t],this.plugins).render(e.elem)))}renderInternal(){const e={name:this.nodeName,value:this.data};this.wrapper.removeClass(a),this.plugins.forEach(((t,n)=>{var r;return null===(r=t.beforeRender)||void 0===r?void 0:r.call(t,this.pluginContext[n],e)})),this.header=t("div").addClass("prop-header").appendTo(this.wrapper).append(t("span").text(e.name).addClass("prop-name")),this.isExpandable?(this.childrenWrapper=t("div").addClass("prop-children"),this.header.append(t("span").addClass("prop-expand")).on("click",(()=>this.toggleExpand())),this.wrapper.append(this.childrenWrapper)):this.header.append(t("span").text(":").addClass("prop-separator")).append(t("span").addClass("prop-value","prop-type-"+typeof e.value).text(r(e.value))),this.plugins.forEach(((e,t)=>{var n;return null===(n=e.afterRender)||void 0===n?void 0:n.call(e,this.pluginContext[t])}))}init(){switch(typeof this.data){case"bigint":case"boolean":case"number":case"string":case"undefined":this.isExpandable=!1;break;case"object":this.isExpandable=null!=this.data&&Object.keys(this.data).length>0;break;default:throw"Type not supported"}this.plugins.forEach(((e,t)=>{var n;this.pluginContext[t]=this.pluginContext[t]||{node:this},null===(n=e.nodeInit)||void 0===n||n.call(e,this.pluginContext[t])}))}}const r=e=>void 0===e?"undefined":null===e?"null":"object"==typeof e?Array.isArray(e)?"[]":"{}":e.toString(),a="prop-expanded",s=e=>Array.isArray(e)?`[${e.length}]`:`{${Object.keys(e).length}}`,o=(e,t)=>{if(!t.properties)return"";let n=t.properties.names.filter((t=>null!=e[t]&&""!=e[t])).map((n=>(t.properties.printNames?n+":":"")+e[n]));return t.properties.maxCount&&(n=n.slice(0,t.properties.maxCount)),i(n.map((e=>i(e,t.properties.maxValueLength))).join(", "),t.maxTotalLenght)},i=(e,t)=>!t||!e||e.length<=t?e:e.substr(0,t-3)+"...",l={text:"Copy name",onClick:e=>{navigator.clipboard.writeText(e.node.nodeName)}},d={text:"Copy value",onClick:e=>{navigator.clipboard.writeText(e.node.isExpandable?JSON.stringify(e.node.data):e.node.data)}},p={text:"Copy formatted JSON",isHidden:e=>!e.node.isExpandable,onClick:e=>{navigator.clipboard.writeText(e.node.isExpandable?JSON.stringify(e.node.data,null,2):e.node.data)}},h=/^[\{\[].*?[\}\]]$/,u={text:"Parse JSON",isHidden:e=>"string"!=typeof e.node.data||!h.test(e.node.data),onClick:e=>{e.node.data=JSON.parse(e.node.data),e.node.reRender&&e.node.reRender()}},c={text:e=>e.sortedAsc?"Sort desc":"Sort asc",isHidden:e=>!e.node.isExpandable,onClick:e=>{if(Array.isArray(e.node.data))e.node.data=e.node.data.sort(),e.sortedAsc&&(e.node.data=e.node.data.reverse());else{let t=Object.keys(e.node.data).sort();e.sortedAsc&&(t=t.reverse()),e.node.data=t.reduce(((t,n)=>(t[n]=e.node.data[n],t)),{})}e.sortedAsc=!e.sortedAsc,e.node.reRender&&e.node.reRender(),e.node.toggleExpand(!0)}};var g=Object.freeze({__proto__:null,copyFormattedValue:p,copyName:l,copyValue:d,parseJsonValue:u,sortProperties:c});const m=(e=[])=>new v(e);class v{constructor(e=[]){this.menuItems=e,document.body.addEventListener("click",(()=>this.closeActiveMenu())),0==e.length&&(this.menuItems.push(l),this.menuItems.push(d),this.menuItems.push(p))}nodeInit(e){null==this.rootNode&&(this.rootNode=e.node)}afterRender(e){const n=t("span").text("...").addClass("prop-menu-button"),r=t("div").addClass("prop-menu-wrapper").append(n).appendTo(e.node.header);n.on("click",(t=>this.renderMenu(t,r,e)))}closeActiveMenu(){var e;this.activeMenu&&(null===(e=this.activeMenu.elem.parentElement)||void 0===e||e.classList.remove("prop-menu-open"),this.activeMenu.remove(),this.activeMenu=void 0)}renderMenu(e,n,r){e.stopPropagation(),this.closeActiveMenu(),this.activeMenu=t("div").addClass("prop-menu"),this.menuItems.forEach((e=>{var n,a;if(null===(n=e.isHidden)||void 0===n?void 0:n.call(e,r))return;const s="function"==typeof e.text?e.text(r):e.text,o=null===(a=e.isDisabled)||void 0===a?void 0:a.call(e,r);t("div").text(s).addClass("prop-menu-item",o?"disabled":"enabled").on("click",(t=>{e.onClick(r),t.stopPropagation(),!o&&this.closeActiveMenu()})).appendTo(this.activeMenu)})),this.activeMenu.appendTo(n),n.addClass("prop-menu-open"),this.adjustPosition()}adjustPosition(){const e=this.activeMenu.elem,t=this.rootNode.wrapper.elem.getBoundingClientRect(),n=e.getBoundingClientRect();let r="";n.right>=t.right&&(r+="left: auto; right: 0;"),n.bottom>=t.bottom&&(r+=`bottom: ${n.top-e.parentElement.getBoundingClientRect().top}px;`),""!=r&&this.activeMenu.attr("style",r)}}m.items=g;function f(e,t,n,r){let a=[];switch(typeof e){case"object":if(null==e)return a;Object.keys(e).forEach((r=>{const s=[...t,r];n(r)?a.push(s):a=a.concat(f(e[r],s,n))}));break;case"number":e=e.toString();case"string":n(e)&&a.push(t)}return a}const x=(e,t)=>{let n;return r=>t?r.includes(e):(n||(n=new RegExp(e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i")),n.test(r))};const C=(e,t)=>!(t.length>e.length)&&t.every(((t,n)=>t==e[n]));function b(e,n,r,a){const s=t(e.node.header.elem.querySelector(n?".prop-name":".prop-value"));s.addClass("prop-truncated");const o=t("span").addClass("prop-pill","prop-length").text(function(e,t=1){if(0===e)return"0";const n=1024,r=t<0?0:t,a=["","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,s)).toFixed(r))+(a[s]?" "+a[s]:"")}(r)).appendTo(s);a&&o.addClass("prop-clickable").attr("title","string"==typeof a?a:"Show full value").on("click",(t=>{s.empty().text(n?e.node.nodeName:e.node.data),t.stopPropagation()}))}var y=Object.freeze({__proto__:null,autoExpand:e=>({afterRender:t=>{e&&t.node.path.length-1>=e||t.node.toggleExpand(!0)}}),propertyGroups:e=>({beforeRenderProperties:(t,n)=>(t.propsToRender=n,n.slice(0,e)),afterRenderProperties:(n,r)=>{n.node.path;let a=n.propsToRender;if(delete n.propsToRender,!a||a.length<=e)return;let s=e;do{a=a.slice(e);let r=a.slice(0,e);const o=t("div");t("span").text(`${s+1} - ${s+r.length}`).addClass("prop-group","prop-pill").on("click",(()=>{o.empty(),n.node.renderProperties(o,r)})).appendTo(o),o.appendTo(n.node.childrenWrapper),s+=e}while(a.length>e)}}),propertyMenu:m,propertyTeaser:e=>({afterRender:n=>{var r;n.node.isExpandable&&t("span").addClass("prop-value-teaser").text((r=n.node.data,[!1===e.showCounts?"":s(r),o(r,e)].filter((e=>""!=e)).join(" "))).appendTo(n.node.header)}}),search:(e,t)=>{let n=null,r=null;return{nodeInit:e=>{null==n&&(n=e.node)},afterRender:e=>{r&&e.node.toggleExpand(!0)},beforeRenderProperties:(e,t)=>r?t.filter((t=>r.some((n=>C(n,e.node.path)&&C(n,[...e.node.path,t]))))):t,query:a=>{if(!n)throw"Root node not initialized";n.toggleExpand(!1);let s=function(e,t,n,r){const a=x(n,!!(null==r?void 0:r.caseSensitive));return new Promise(((n,r)=>{n(f(e,t,a))}))}(e,n.path,a,t).then((e=>(r=e,r.length&&(null==n||n.toggleExpand(!0)),r=null,e)));return s.catch((()=>{r=null})),s}}},truncate:e=>{const t=(e=Object.assign({maxNameLength:20,maxValueLength:40,showLengthPill:!0,enableClickToExpand:!0},e)).maxNameLength,n=e.maxValueLength;return{beforeRender:(e,r)=>{if(t&&r.name.length>t&&(e.fullNameLength=r.name.length,r.name=r.name.substr(0,t-3)+"..."),e.node.isExpandable||null===r.value||void 0===r.value)return;const a=r.value.toString();n&&a.length>n&&(e.fullValueLength=a.length,r.value=a.substr(0,n-3)+"...")},afterRender:t=>{e.showLengthPill&&(t.fullNameLength||t.fullValueLength)&&(t.fullValueLength&&b(t,!1,t.fullValueLength,e.enableClickToExpand),t.fullNameLength&&b(t,!0,t.fullNameLength,e.enableClickToExpand))}}}});export{n as JsonViewer,y as plugins};
//# sourceMappingURL=json-viewer.es.js.map
